<!doctype html><html lang=en-us><head><title>Blogging under GitHub Pages | berfr blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://berfr.github.io/posts/blogging-under-github-pages/><link rel=stylesheet href=/css/styles.min.css></head><body><header><h2><a href=/>berfr blog</a></h2></header><hr><article class=post><header><h1>Blogging under GitHub Pages</h1><div class=post-time>Posted on June 14, 2020.</div></header><p>I recently moved my blog from <a href=https://aws.amazon.com/s3>Amazon S3</a> using a custom domain to <a href=https://pages.github.com>GitHub
Pages</a> using the default <code>&lt;username>.github.io</code> domain. Here, I&rsquo;ll discuss a few
thoughts on this.</p><h2 id=what-happens-when-i-die>What happens when I die</h2><p>One of the reasons I chose to host this blog under GitHub Pages has to do with
my eventual death. I like the idea of the articles written here living on after
I am gone and this is more likely using a free hosting service. With an S3
bucket and a registered domain, your work disappears from the internet when the
credit card expires and the account is due. It is true that no one knows for
certain where GitHub or their Pages product will be in a few years but it is
hard to imagine them purging the content of millions of people in the coming
years. Not much has changed on the user side of GitHub Pages since its
introduction in 2008 and I would be perfectly happy if my site outlived me by a
decade.</p><h2 id=hugo-and-github-actions>Hugo and GitHub Actions</h2><p>As for the technical side of this blog, I set up a simple <a href=https://github.com/features/actions>GitHub Actions</a>
workflow to build the website using <a href=https://gohugo.io>Hugo</a> and deploy the result. There are
multiple projects available on the Actions Marketplace but they are not
necessary. Doing it yourself requires only a few easy steps.</p><p>First, you need to add a Deploy Key and Secret to your <code>&lt;username>.github.io</code>
repository. These will be the public and private keys of a newly generated SSH
key. With this in place, the machine that builds the website in CI will be able
to push to the <code>master</code> branch of the project where the resulting website needs
to be. Note that the main branch of your repository cannot be <code>master</code>.</p><p>After setting up the repo keys, you can add the following files to your project
and adapt them to your specific needs:</p><p><a href=https://github.com/berfr/berfr.github.io/blob/eb875880acba00ec8c71d2da5bb9ff3386edd2cf/Makefile><code>Makefile@eb87588</code></a>:</p><div class=highlight><pre class=chroma><code class=language-makefile data-lang=makefile><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>setup</span> <span class=n>build</span> <span class=n>publish</span>

<span class=nf>setup</span><span class=o>:</span>
	rm -rf public
	git clone --branch master git@github.com:berfr/berfr.github.io.git public

<span class=nf>build</span><span class=o>:</span>
	rm -rf public/*
	hugo --minify

<span class=nf>publish</span><span class=o>:</span>
	git -C public config user.email <span class=s2>&#34;berfr4@gmail.com&#34;</span>
	git -C public config user.name <span class=s2>&#34;berfr&#34;</span>
	git -C public add --all
	git -C public commit -m <span class=s2>&#34;Publishing to gh-pages: </span><span class=k>$(</span>shell date +%y-%m-%d<span class=se>\ </span>%H:%M<span class=k>)</span><span class=s2>&#34;</span> <span class=o>||</span> <span class=nb>true</span>
	git -C public push origin master
</code></pre></div><p><a href=https://github.com/berfr/berfr.github.io/blob/eb875880acba00ec8c71d2da5bb9ff3386edd2cf/.github/workflows/workflow.yml><code>.github/workflows/workflow.yml@eb87588</code></a>:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>Main<span class=w> </span>workflow<span class=w>
</span><span class=w></span><span class=k>on</span><span class=p>:</span><span class=w> </span>push<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>build</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>name</span><span class=p>:</span><span class=w> </span>Build<span class=w> </span>and<span class=w> </span>Publish<span class=w>
</span><span class=w>    </span><span class=k>runs-on</span><span class=p>:</span><span class=w> </span>ubuntu-latest<span class=w>
</span><span class=w>    </span><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/checkout@v2<span class=w>
</span><span class=w>        </span><span class=k>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>Hugo<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>sudo<span class=w> </span>snap<span class=w> </span>install<span class=w> </span>hugo<span class=w> </span>--channel=extended<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Set<span class=w> </span>up<span class=w> </span>SSH<span class=w> </span>key<span class=w>
</span><span class=w>        </span><span class=k>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>DEPLOY_KEY</span><span class=p>:</span><span class=w> </span>${{<span class=w> </span>secrets.DEPLOY_KEY<span class=w> </span>}}<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir ~/.ssh</span><span class=w>
</span><span class=w>          </span>echo<span class=w> </span><span class=s2>&#34;$DEPLOY_KEY&#34;</span><span class=w> </span>&gt;<span class=w> </span>~/.ssh/id_rsa<span class=w>
</span><span class=w>          </span>chmod<span class=w> </span><span class=m>600</span><span class=w> </span>~/.ssh/id_rsa<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Set<span class=w> </span>up<span class=w> </span>public<span class=w> </span>directory<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>make<span class=w> </span>setup<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Build<span class=w> </span>website<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>GIT_CONFIG_NOSYSTEM=<span class=kc>true</span><span class=w> </span>make<span class=w> </span>build<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w> </span>website<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>make<span class=w> </span>publish<span class=w>
</span></code></pre></div><p>With this in place, every push to the repository will trigger a website build
and the results will be published automatically.</p><h2 id=other-thoughts>Other thoughts</h2><p>Although this setup is good for now and probably for the next few years, it is
not ideal. It would be really nice for the platform itself to be open source
which I can see happening eventually. A guarantee of some sort would also ease
my mind. It is important to know that I am currently not in control of the
availability of my blog; if GitHub/Microsoft does not like it, they can simply
take it down. Even if I am not really worried about that, it is still a
possibility. There will certainly be a better hosting method in the future but
until then, this one isn&rsquo;t so bad.</p></article><hr><footer><p><a href=https://github.com/berfr>GitHub</a> /
<a href=https://git.sr.ht/~berfr>SourceHut</a></p><p><a href=/publickey.txt>67CA4E4F727349D3</a></p><p><a href=mailto:berfr4@gmail.com>berfr4@gmail.com</a></p><p><a href=/index.xml>RSS</a></p></footer></body></html>